# COBOLのデータ構造

## 概要

COBOLでは、データの構造を階層的に定義します。レコード、グループ項目、基本項目の概念を使用して、複雑なデータ構造を表現できます。

## データ定義の基本

### レベル番号
- `01` - レコードレベル
- `02` - `77` - グループ項目・基本項目レベル
- `88` - 条件名レベル

### 基本構造
```cobol
       01  CUSTOMER-RECORD.
           05  CUSTOMER-ID      PIC 9(8).
           05  CUSTOMER-NAME    PIC X(30).
           05  CUSTOMER-ADDRESS.
               10  STREET       PIC X(40).
               10  CITY         PIC X(20).
               10  ZIP-CODE     PIC X(10).
```

## データ型とPICTURE句

### 数値型
```cobol
       01  WS-NUMERIC-FIELDS.
           05  WS-INTEGER      PIC 9(5).        *> 5桁の整数
           05  WS-DECIMAL      PIC 9(5)V99.     *> 5桁整数 + 2桁小数
           05  WS-SIGNED       PIC S9(7).       *> 符号付き7桁整数
           05  WS-SCALE        PIC 9(3)V9(2).   *> 3桁整数 + 2桁小数
```

### 文字型
```cobol
       01  WS-CHARACTER-FIELDS.
           05  WS-NAME         PIC X(30).       *> 30文字の文字列
           05  WS-CODE         PIC X(5).        *> 5文字のコード
           05  WS-DESCRIPTION  PIC X(100).      *> 100文字の説明
```

### 特殊な型
```cobol
       01  WS-SPECIAL-FIELDS.
           05  WS-DATE         PIC 9(8).        *> 日付（YYYYMMDD）
           05  WS-TIME         PIC 9(6).        *> 時刻（HHMMSS）
           05  WS-AMOUNT       PIC 9(7)V99.    *> 金額
           05  WS-PERCENT      PIC 9(3)V99.    *> パーセンテージ
```

## グループ項目

### グループ項目の定義
```cobol
       01  INVOICE-RECORD.
           05  INVOICE-HEADER.
               10  INVOICE-NO      PIC 9(8).
               10  INVOICE-DATE    PIC 9(8).
               10  CUSTOMER-INFO.
                   15  CUST-ID     PIC 9(8).
                   15  CUST-NAME   PIC X(30).
           05  INVOICE-DETAILS.
               10  ITEM-COUNT      PIC 9(3).
               10  TOTAL-AMOUNT    PIC 9(7)V99.
```

### グループ項目の操作
```cobol
           *> グループ全体の移動
           MOVE INVOICE-HEADER TO WS-HEADER-COPY
           
           *> グループ内の特定項目の操作
           MOVE 100 TO INVOICE-HEADER.INVOICE-NO
           
           *> グループの比較
           IF INVOICE-HEADER = WS-HEADER-COPY
               DISPLAY "ヘッダーが一致します"
           END-IF
```

## 配列（OCCURS句）

### 1次元配列
```cobol
       01  WS-ARRAY.
           05  WS-ELEMENTS OCCURS 10 TIMES.
               10  WS-VALUE    PIC 9(5).
               10  WS-FLAG     PIC X.

       *> 配列の操作
           PERFORM VARYING WS-INDEX FROM 1 BY 1
               UNTIL WS-INDEX > 10
               MOVE WS-INDEX TO WS-ELEMENTS(WS-INDEX).WS-VALUE
               MOVE "N" TO WS-ELEMENTS(WS-INDEX).WS-FLAG
           END-PERFORM
```

### 2次元配列
```cobol
       01  WS-2D-ARRAY.
           05  WS-ROWS OCCURS 5 TIMES.
               10  WS-COLS OCCURS 3 TIMES.
                   15  WS-CELL PIC 9(3).

       *> 2次元配列の操作
           PERFORM VARYING WS-ROW FROM 1 BY 1
               UNTIL WS-ROW > 5
               PERFORM VARYING WS-COL FROM 1 BY 1
                   UNTIL WS-COL > 3
                   MOVE 0 TO WS-2D-ARRAY(WS-ROW, WS-COL)
               END-PERFORM
           END-PERFORM
```

### 可変長配列
```cobol
       01  WS-VARIABLE-ARRAY.
           05  WS-COUNT        PIC 9(3).
           05  WS-ITEMS OCCURS 1 TO 100 TIMES
               DEPENDING ON WS-COUNT.
               10  WS-ITEM-ID      PIC 9(8).
               10  WS-ITEM-NAME    PIC X(30).
```

## 条件名（88レベル）

### 条件名の定義
```cobol
       01  WS-STATUS-FIELD    PIC X.
           88  WS-ACTIVE       VALUE "A".
           88  WS-INACTIVE     VALUE "I".
           88  WS-SUSPENDED    VALUE "S".
           88  WS-VALID-STATUS VALUES "A", "I", "S".

       01  WS-AMOUNT-FIELD    PIC 9(7)V99.
           88  WS-HIGH-AMOUNT VALUE 10000.00 THRU 99999.99.
           88  WS-MEDIUM-AMOUNT VALUE 1000.00 THRU 9999.99.
           88  WS-LOW-AMOUNT   VALUE 0.00 THRU 999.99.
```

### 条件名の使用
```cobol
           *> 条件名による分岐
           IF WS-ACTIVE
               DISPLAY "アクティブな状態です"
           ELSE IF WS-INACTIVE
               DISPLAY "非アクティブな状態です"
           ELSE IF WS-SUSPENDED
               DISPLAY "一時停止状態です"
           END-IF

           *> 範囲条件の使用
           IF WS-HIGH-AMOUNT
               DISPLAY "高額取引です"
           ELSE IF WS-MEDIUM-AMOUNT
               DISPLAY "中額取引です"
           ELSE IF WS-LOW-AMOUNT
               DISPLAY "低額取引です"
           END-IF
```

## データの初期化

### VALUE句による初期化
```cobol
       01  WS-INITIALIZED-FIELDS.
           05  WS-COUNTER      PIC 9(3) VALUE ZERO.
           05  WS-FLAG         PIC X VALUE "N".
           05  WS-NAME         PIC X(20) VALUE SPACES.
           05  WS-ARRAY        PIC 9(3) VALUE 0 OCCURS 10 TIMES.
```

### 実行時の初期化
```cobol
           *> 単一項目の初期化
           MOVE ZERO TO WS-COUNTER
           MOVE SPACES TO WS-NAME
           MOVE "N" TO WS-FLAG

           *> グループ全体の初期化
           INITIALIZE WS-CUSTOMER-RECORD

           *> 特定の項目を除く初期化
           INITIALIZE WS-CUSTOMER-RECORD
               REPLACING NUMERIC DATA BY ZERO
               ALPHANUMERIC DATA BY SPACES
```

## データの検証

### 数値チェック
```cobol
       01  WS-VALIDATION.
           05  WS-AMOUNT       PIC 9(7)V99.
           05  WS-AMOUNT-CHECK PIC X VALUE "N".
               88  WS-VALID-AMOUNT VALUE "Y".
               88  WS-INVALID-AMOUNT VALUE "N".

       *> 数値チェックの実装
           IF WS-AMOUNT NUMERIC
               IF WS-AMOUNT > 0 AND WS-AMOUNT <= 999999.99
                   MOVE "Y" TO WS-AMOUNT-CHECK
               ELSE
                   MOVE "N" TO WS-AMOUNT-CHECK
               END-IF
           ELSE
               MOVE "N" TO WS-AMOUNT-CHECK
           END-IF
```

### 文字チェック
```cobol
       01  WS-CHAR-VALIDATION.
           05  WS-CODE         PIC X(5).
           05  WS-CODE-CHECK   PIC X VALUE "N".
               88  WS-VALID-CODE VALUE "Y".
               88  WS-INVALID-CODE VALUE "N".

       *> 文字チェックの実装
           IF WS-CODE NOT = SPACES
               IF WS-CODE ALPHABETIC
                   MOVE "Y" TO WS-CODE-CHECK
               ELSE
                   MOVE "N" TO WS-CODE-CHECK
               END-IF
           ELSE
               MOVE "N" TO WS-CODE-CHECK
           END-IF
```

## データの変換

### 数値変換
```cobol
       01  WS-CONVERSION.
           05  WS-STRING-NUM   PIC X(10).
           05  WS-NUMERIC      PIC 9(8).

       *> 文字から数値への変換
           MOVE "12345" TO WS-STRING-NUM
           MOVE WS-STRING-NUM TO WS-NUMERIC

       *> 数値から文字への変換
           MOVE 67890 TO WS-NUMERIC
           MOVE WS-NUMERIC TO WS-STRING-NUM
```

### 日付変換
```cobol
       01  WS-DATE-CONVERSION.
           05  WS-DATE-YYYYMMDD PIC 9(8).
           05  WS-DATE-YYYY     PIC 9(4).
           05  WS-DATE-MM       PIC 9(2).
           05  WS-DATE-DD       PIC 9(2).

       *> 日付の分解
           MOVE 20231225 TO WS-DATE-YYYYMMDD
           MOVE WS-DATE-YYYYMMDD(1:4) TO WS-DATE-YYYY
           MOVE WS-DATE-YYYYMMDD(5:2) TO WS-DATE-MM
           MOVE WS-DATE-YYYYMMDD(7:2) TO WS-DATE-DD
```

## ベストプラクティス

### 1. 命名規則
- 意味のある名前を使用
- 接頭辞・接尾辞の統一
- 一貫性の維持

### 2. データ定義
- 適切なPICTURE句の使用
- 必要最小限のサイズ設定
- 将来の拡張性を考慮

### 3. 初期化
- 適切な初期値の設定
- 実行時の初期化処理
- データの整合性確保

### 4. 検証
- 入力データの検証
- 境界値のチェック
- エラーハンドリング

## まとめ

COBOLのデータ構造は、階層的な定義により複雑なビジネスデータを表現できます。適切な設計と実装により、保守性の高いデータ処理プログラムを作成できます。
